<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Breakout</title>
    <link rel="stylesheet" type="text/css" href="estilo.css">
</head>
<body>
<div id="container">
    <div id="containerJogo">
        <canvas id="game" width = "400" height="600"></canvas>
    </div>
</div>


<script>
    window.onload = iniciar;
    window.onkeydown = teclaPressionada;
    window.onkeyup = teclaSolta;

    var jogador = new Raquete(150,580,100,10);
    var bola = new Bola(200,570,10);
    var mapaTecla = new Array();
    var temporizador;
    var estado = 0;


    var tijolos = new Array();
    tijolos.push(new Tijolo(20,10,50,10));
    tijolos.push(new Tijolo(72,10,50,10));
    tijolos.push(new Tijolo(124,10,50,10));
    tijolos.push(new Tijolo(176,10,50,10));
    tijolos.push(new Tijolo(228,10,50,10));
    tijolos.push(new Tijolo(280,10,50,10));
    tijolos.push(new Tijolo(332,10,50,10));
    tijolos.push(new Tijolo(40,22,50,10));
    tijolos.push(new Tijolo(92,22,50,10));
    tijolos.push(new Tijolo(144,22,50,10));
    tijolos.push(new Tijolo(196,22,50,10));
    tijolos.push(new Tijolo(248,22,50,10));
    tijolos.push(new Tijolo(300,22,50,10));
    tijolos.push(new Tijolo(60,34,50,10));
    tijolos.push(new Tijolo(112,34,50,10));
    tijolos.push(new Tijolo(164,34,50,10));
    tijolos.push(new Tijolo(216,34,50,10));
    tijolos.push(new Tijolo(268,34,50,10));
    tijolos.push(new Tijolo(80,46,50,10));
    tijolos.push(new Tijolo(132,46,50,10));
    tijolos.push(new Tijolo(184,46,50,10));
    tijolos.push(new Tijolo(236,46,50,10));
    tijolos.push(new Tijolo(100,58,50,10));
    tijolos.push(new Tijolo(152,58,50,10));
    tijolos.push(new Tijolo(204,58,50,10));
    tijolos.push(new Tijolo(120,70,50,10));
    tijolos.push(new Tijolo(172,70,50,10));
    tijolos.push(new Tijolo(145,82,50,10));







    function iniciar() {
        var canvas = document.getElementById("game");
        contexto = canvas.getContext("2d");

        jogador.pintar();
        temporizador = setInterval(mainloop,16);


    }
    
    
    // ---------------------Inicio da classe e métodos Raquete -------------------------
    function Raquete(x,y,largura,altura) {
        this.x = x;
        this.y = y;
        this.largura = largura;
        this.altura = altura;

        this.pintar = function(){
            contexto.fillRect(this.x, this.y, this.largura, this.altura);
        }

        this.mover = function (dx) {
            this.x += dx;

        }
        this.detectarColisaoRaquete = function(){
            if ((jogador.x + jogador.largura)-jogador.largura <= 0){
                return "esq";
            }
            else if ((jogador.x + jogador.largura)>=400){
                return "dir";
            }



        }
    }


    

    //Função de controle da raquete
    function teclaPressionada(evento) {
        mapaTecla[evento.keyCode] = true;
    }
    function teclaSolta(evento) {
        mapaTecla[evento.keyCode] = false;
    }
    // ---------------------Fim das classe e métodos Raquete-------------------------


    //Função de limpar a tela e pintar objetos
    function pintar() {
        contexto.clearRect(0,0,400,600);
        jogador.pintar();
        bola.pintar();

        for (t in tijolos){
            tijolos[t].pintar();
        }
    }
    


    //Classe e métodos bola
    function Bola(x,y,raio) {
        this.x = x;
        this.y = y;
        this.raio = raio;
        this.dirX = (Math.random()>0.5)?3:-3;
        this.dirY = -3;

        this.pintar = function () {
            contexto.beginPath();
            contexto.arc(this.x, this.y, this.raio, 0,2*Math.PI);
            contexto.fill();
        }//método de desenhar a bola pintada
        
        this.mover = function () {
            this.x += this.dirX;
            this.y += this.dirY;
        }//método de mover a direção da bola

        this.inverterX = function () {
            this.dirX *= -1;
        }//método de inverter a direção X
        this.inverterY = function () {
            this.dirY *= -1;
        }//método de inverter a direção Y

        this.verificaColisao = function () {
            if ((this.x - this.raio) <= 0 || (this.x + this.raio)>=400){
                this.inverterX();
            }

            if ((this.y - this.raio) <= 0 || detectarColisaoRaquetexBola()){
                this.inverterY();
            }

            if ((this.y - this.raio) >= 600){
                estado = 2;
            }
        }//método de colisão (caso o ocorra, chama o método de inverter a direção)



    }// ---------------------Fim da classe e métodos Bola -------------------------

    function Tijolo(x,y,largura,altura) {
        this.x = x;
        this.y = y;
        this.largura = largura;
        this.altura = altura;
        
        this.pintar = function () {
            contexto.fillRect(this.x, this.y, this.largura, this.altura);
            contexto.fillStyle = '#555555';
            contexto.strokeRect(this.x, this.y, this.largura, this.altura);
            contexto.fillStyle = '#000000';
        }

        this.detectarColisaoTijoloxBola = function(){
            var xMaisProximo = clamp(bola.x, this.x, (this.x+this.largura));
            var yMaisProximo = clamp(bola.y, this.y, (this.y+this.altura));
            var distanciaX = bola.x - xMaisProximo;
            var distanciaY = bola.y - yMaisProximo;
            var distancia = (distanciaX*distanciaX)+(distanciaY*distanciaY);
            if (distancia < (bola.raio*bola.raio)){
                if(bola.x>this.x && bola.x<(this.x+this.largura)){
                    bola.inverterY();
                    }
                else if(bola.y>this.y && bola.y<(this.y+this.altura)){
                    bola.inverterX();
                    }
                else{
                    bola.inverterY();
                    bola.inverterX();
                }
                return true;
            }
            return false;
        }
        
    }// ---------------------Fim classe e métodos Tijolo-------------------------
    
    function clamp(val,min,max) {
        return Math.max(min,Math.min(max,val));
    }//Função clamp (verifica a distancia de 2 pontos)
    
    function detectarColisaoRaquetexBola() {
        var xMaisProximo = clamp(bola.x, jogador.x,(jogador.x + jogador.largura));
        var yMaisProximo = clamp(bola.y, jogador.y, (jogador.y + jogador.altura));

        var distanciaX = bola.x - xMaisProximo;
        var distanciaY = bola.y - yMaisProximo;
        var distancia = (distanciaX * distanciaX) + (distanciaY * distanciaY);

        return distancia < (bola.raio * bola.raio);
    }//Função que detecta a ocorrencia de colisão Raquete e bola


    
    function mainloop() {
        if (mapaTecla[37] == true && estado == 1){
            if(jogador.detectarColisaoRaquete() == "esq"){
                jogador.mover(0);
            }
            else{
                jogador.mover(-5);
            }
        }

        if (mapaTecla[39] == true && estado == 1)
        {
            if(jogador.detectarColisaoRaquete() == "dir"){
                jogador.mover(0);
            }
            else{
                jogador.mover(5);
            }

        }
        if (mapaTecla[32] == true  && estado == 0){
            estado = 1;
        }// condição para o jogo iniciar com a keycode == espaço
        if (estado == 1){
            bola.mover();
        }
        jogador.detectarColisaoRaquete();
        bola.verificaColisao();

        for (t in tijolos){
            if (tijolos[t].detectarColisaoTijoloxBola()){
                tijolos.splice(t,1);
                if (tijolos.length == 0){
                    estado = 3;
                }
            }
        }

        pintar();
    }//fim da função loop principal do jogo
    
    
    
</script>

</body>
</html>